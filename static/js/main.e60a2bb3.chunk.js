(this["webpackJsonpreact-crypto-orderbook"]=this["webpackJsonpreact-crypto-orderbook"]||[]).push([[0],{66:function(e,t,n){"use strict";n.r(t);var c=n(2),r=n(92),i=n(93),a=n(0),o=n.n(a),s=n(16),u=n.n(s),d=n(83),l=n(94),j=n(84),b=n(85),f=n(86),O=n(87),p=n(88),h=n(81),x=n(82),v=n(89),g=n(90),m=n(91),y=n(10),k=n(27),S=n(50);function C(e){return{price:e[0],quantity:e[1]}}var w=Object(a.createContext)(void 0),M=function(){var e=Object(a.useContext)(w);if(!e)throw new Error("Context provider not found, make sure you include <OrderBookContext> above this component!");return e},T=function(e){var t=e.children,n=Object(a.useRef)(),r=Object(a.useState)(!0),i=Object(y.a)(r,2),o=i[0],s=i[1],u=Object(a.useState)(!1),d=Object(y.a)(u,2),l=d[0],j=d[1],b=Object(a.useState)("PI_XBTUSD"),f=Object(y.a)(b,2),O=f[0],p=f[1],h=Object(a.useState)({asks:[],bids:[]}),x=Object(y.a)(h,2),v=x[0],g=x[1],m=Object(a.useState)(v),M=Object(y.a)(m,2),T=M[0],N=M[1],E=Object(a.useState)(2.5),B=Object(y.a)(E,2),q=B[0],P=B[1],I=Object(a.useState)(0),R=Object(y.a)(I,2),z=R[0],F=R[1],W=Object(a.useCallback)((function(e){n.current&&n.current.readyState===n.current.OPEN&&n.current.send(JSON.stringify(e))}),[]);Object(a.useEffect)((function(){return n.current=new WebSocket("wss://www.cryptofacilities.com/ws/v1"),s(!0),n.current.addEventListener("open",(function(){j(!0),s(!1)})),n.current.addEventListener("close",(function(){j(!1),s(!1)})),function(){var e;null===(e=n.current)||void 0===e||e.close()}}),[z]);var J=Object(a.useCallback)((function(){F((function(e){return e+1}))}),[]);Object(a.useEffect)((function(){if(l&&n.current){g({asks:[],bids:[]}),W({event:"subscribe",feed:"book_ui_1",product_ids:[O]});var e=function(e){try{var t=JSON.parse(e.data);if(!t.bids&&!t.asks)return;g((function(e){return function(e,t){var n=Object(S.a)({},e);return["asks","bids"].forEach((function(e){n[e]=[].concat(Object(k.a)(t[e].map(C)),Object(k.a)(n[e])).filter((function(e,t,n){return!!e.quantity&&t===n.findIndex((function(t){return t.price===e.price}))}))})),n}(e,t)}))}catch(n){console.error("Received unparseable message",e.data,n)}};return n.current.addEventListener("message",e),function(){var t;return null===(t=n.current)||void 0===t?void 0:t.removeEventListener("message",e)}}}),[l,O,W]),Object(a.useEffect)((function(){N(function(e,t){var n={asks:[],bids:[]};return["asks","bids"].forEach((function(c){var r=e[c].reduce((function(e,n){var r=n.price-n.price%t+("asks"===c?t:0);return void 0===e[r]&&(e[r]=0),e[r]+=n.quantity,e}),{});n[c]=Object.entries(r).map((function(e){var t=Object(y.a)(e,2),n=t[0],c=t[1];return{price:parseFloat(n),quantity:c}}))})),n}(v,q))}),[v,q]);var L=Object(a.useMemo)((function(){return{isConnecting:o,isConnected:l,orderBook:T,product:O,groupSize:q,reconnect:J,setProduct:p,setGroupSize:P}}),[o,l,T,O,q,J]);return Object(c.jsx)(w.Provider,{value:L,children:t})},N=n(37),E=n(36);function B(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}var q=function(e){var t=e.orderType,n=e.orders,r=P(),i=Object(a.useMemo)((function(){var e=Object(k.a)(n).sort((function(e,n){return"bid"===t?n.price-e.price:e.price-n.price})).slice(0,6);return"ask"===t&&e.reverse(),e}),[n,t]),o="bid"===t?0:i.reduce((function(e,t){return e+t.quantity}),0);return Object(c.jsxs)(c.Fragment,{children:[i.map((function(e){return o="bid"===t?o+e.quantity:o-e.quantity,Object(c.jsxs)(h.a,{className:"".concat(r.row," ").concat(t),children:[Object(c.jsx)(x.a,{children:B(e.price)}),Object(c.jsx)(x.a,{children:B(e.quantity)}),Object(c.jsx)(x.a,{children:B(o+("bid"===t?0:e.quantity))})]},"".concat(t,"-").concat(e.price,"-").concat(e.quantity))})),!i.length&&Object(c.jsx)(h.a,{children:Object(c.jsxs)(x.a,{colSpan:3,children:["No ",t," orders"]})})]})},P=Object(d.a)({row:{"&.bid .MuiTableCell-root":{color:N.a[500]},"&.ask .MuiTableCell-root":{color:E.a[500]},"&:hover":{background:"rgba(255, 255, 255, 0.05)","& .MuiTableCell-root:first-child":{fontWeight:600}}}}),I=n(70),R=n(48),z=n.n(R),F=n(47),W=n.n(F),J=[.5,1,2.5,5,10,25,50,100,1e3],L=function(){var e=_(),t=M(),n=t.orderBook,r=t.groupSize,i=t.setGroupSize,a=J.indexOf(r),o=n.asks.reduce((function(e,t){return Math.min(e,t.price)}),1/0)-n.bids.reduce((function(e,t){return Math.max(e,t.price)}),0);return Object(c.jsx)(h.a,{children:Object(c.jsx)(x.a,{colSpan:3,children:Object(c.jsxs)("div",{className:e.cell,children:[Object(c.jsxs)("div",{className:"".concat(e.section," ").concat(e.spread),children:["Spread: ",o===1/0?"N/A":o]}),Object(c.jsxs)("div",{className:e.section,children:[Object(c.jsxs)("span",{children:["Group: ",r]}),Object(c.jsx)(I.a,{disabled:r===J[0],className:e.groupButton,onClick:function(){return i(J[a-1])},children:Object(c.jsx)(W.a,{})}),Object(c.jsx)(I.a,{disabled:r===J[J.length-1],className:e.groupButton,onClick:function(){return i(J[a+1])},children:Object(c.jsx)(z.a,{})})]})]})})})},_=Object(d.a)((function(e){return{cell:{display:"flex",alignItems:"center",color:e.palette.text.secondary},section:{display:"flex",alignItems:"center",paddingRight:e.spacing(4),"&:last-child":{paddingRight:0},"& > span":{marginRight:e.spacing(2)}},spread:{minWidth:140},groupButton:{display:"flex",alignItems:"center",justifyContent:"center",width:32,height:32,borderRadius:"100%","& .MuiSvgIcon-root":{fontSize:16}}}})),D=function(){var e,t=M(),n=t.orderBook,r=t.product,i=t.isConnecting,a=t.isConnected,o=t.reconnect,s=n.asks,u=n.bids;return e=i?Object(c.jsx)(l.a,{display:"flex",alignItems:"center",justifyContent:"center",height:600,children:Object(c.jsx)(j.a,{})}):a?Object(c.jsxs)(O.a,{children:[Object(c.jsx)(p.a,{children:Object(c.jsxs)(h.a,{children:[Object(c.jsx)(x.a,{children:"Price"}),Object(c.jsx)(x.a,{children:"Size"}),Object(c.jsx)(x.a,{children:"Total"})]})}),Object(c.jsxs)(v.a,{children:[Object(c.jsx)(q,{orderType:"ask",orders:s}),Object(c.jsx)(L,{}),Object(c.jsx)(q,{orderType:"bid",orders:u})]})]}):Object(c.jsxs)(l.a,{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",height:600,children:[Object(c.jsx)(b.a,{variant:"h6",children:"Connection failed"}),Object(c.jsx)(l.a,{m:1,children:Object(c.jsx)(f.a,{variant:"outlined",onClick:o,children:"Try again"})})]}),Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)(b.a,{variant:"h3",children:r}),Object(c.jsx)(l.a,{mb:2}),Object(c.jsx)(g.a,{component:m.a,children:e})]})},G=function(){var e=A();return Object(c.jsx)("div",{className:e.app,children:Object(c.jsx)("div",{className:e.inner,children:Object(c.jsx)(T,{children:Object(c.jsx)(D,{})})})})},A=Object(d.a)((function(e){return{app:{display:"flex",justifyContent:"center",minHeight:"100vh",padding:e.spacing(4)},inner:{width:"100%",maxWidth:980}}})),H=n(49),U=Object(H.a)({palette:{type:"dark"},typography:{fontFamily:"PTMono, monospace"},overrides:{MuiCssBaseline:{"@global":{"@font-face":[{fontFamily:"PTMono",fontStyle:"normal",fontDisplay:"swap",fontWeight:400,src:"\n    local('PTMono'),\n    local('PTMono-Regular'),\n    url('/fonts/PTMono-Regular.ttf') format('ttf')\n  "}]}}}});u.a.render(Object(c.jsx)(o.a.StrictMode,{children:Object(c.jsxs)(r.a,{theme:U,children:[Object(c.jsx)(i.a,{}),Object(c.jsx)(G,{})]})}),document.getElementById("root"))}},[[66,1,2]]]);
//# sourceMappingURL=main.e60a2bb3.chunk.js.map